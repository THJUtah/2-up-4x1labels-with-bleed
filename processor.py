<same as previous version of processor.py with fixed gap+bleed>